local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local AkaliNotif = loadstring(game:HttpGet("https://raw.githubusercontent.com/Kinlei/Dynissimo/main/Scripts/AkaliNotif.lua"))();
local Notify = AkaliNotif.Notify;

local gui = Instance.new("ScreenGui")
gui.Name = "OnyxHub"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.Parent = player.PlayerGui

local isMobile = UserInputService.TouchEnabled
local EASING_STYLE = Enum.EasingStyle.Quint
local EASING_DIRECTION = Enum.EasingDirection.Out
local ANIM_DURATION = 0.4

local colors = {
    background = Color3.fromRGB(25, 25, 35),
    header = Color3.fromRGB(40, 40, 55),
    accent = Color3.fromRGB(100, 70, 200),
    text = Color3.fromRGB(240, 240, 240),
    button = Color3.fromRGB(50, 50, 70),
    buttonHover = Color3.fromRGB(65, 65, 90),
    stroke = Color3.fromRGB(100, 70, 200)
}

local topBar = Instance.new("Frame")
topBar.Name = "TopBar"
topBar.Size = UDim2.new(0, 300, 0, 40)
topBar.Position = UDim2.new(0.5, -150, 0, 20)
topBar.BackgroundColor3 = colors.header
topBar.BorderSizePixel = 0

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = topBar

local title = Instance.new("TextLabel")
title.Name = "Title"
title.Text = "Onyx HUB Ware | Auto Farm"
title.Font = Enum.Font.GothamSemibold
title.TextSize = 14
title.TextColor3 = colors.text
title.BackgroundTransparency = 1
title.Size = UDim2.new(0.7, 0, 1, 0)
title.Position = UDim2.new(0.05, 0, 0, 0)
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = topBar

local toggleBtn = Instance.new("ImageButton")
toggleBtn.Name = "ToggleButton"
toggleBtn.Size = UDim2.new(0, 30, 0, 30)
toggleBtn.Position = UDim2.new(1, -35, 0.5, -15)
toggleBtn.BackgroundTransparency = 1
toggleBtn.Image = "rbxassetid://3926305904"
toggleBtn.ImageRectOffset = Vector2.new(884, 284)
toggleBtn.ImageRectSize = Vector2.new(36, 36)
toggleBtn.Parent = topBar

local menuFrame = Instance.new("Frame")
menuFrame.Name = "Menu"
menuFrame.Size = UDim2.new(1, 0, 0, 0)
menuFrame.Position = UDim2.new(0, 0, 1, -5)
menuFrame.BackgroundColor3 = colors.background
menuFrame.BorderSizePixel = 0
menuFrame.ClipsDescendants = true

local menuCorner = Instance.new("UICorner")
menuCorner.CornerRadius = UDim.new(0, 12)
menuCorner.Parent = menuFrame

local content = Instance.new("Frame")
content.Name = "Content"
content.Size = UDim2.new(1, -20, 1, -20)
content.Position = UDim2.new(0, 10, 0, 10)
content.BackgroundTransparency = 1
content.Parent = menuFrame

local avatarFrame = Instance.new("Frame")
avatarFrame.Name = "AvatarFrame"
avatarFrame.Size = UDim2.new(1, 0, 0, 60)
avatarFrame.BackgroundTransparency = 1
avatarFrame.Parent = content

local avatar = Instance.new("ImageLabel")
avatar.Name = "Avatar"
avatar.Size = UDim2.new(0, 50, 0, 50)
avatar.Position = UDim2.new(0, 0, 0.5, -25)
avatar.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
avatar.BorderSizePixel = 0
avatar.Image = "https://www.roblox.com/headshot-thumbnail/image?userId=".. player.UserId .."&width=420&height=420&format=png"

local avatarCorner = Instance.new("UICorner")
avatarCorner.CornerRadius = UDim.new(1, 0)
avatarCorner.Parent = avatar
avatar.Parent = avatarFrame

local username = Instance.new("TextLabel")
username.Name = "Username"
username.Text = player.Name
username.Font = Enum.Font.GothamBold
username.TextSize = 16
username.TextColor3 = colors.text
username.BackgroundTransparency = 1
username.Size = UDim2.new(1, -60, 0, 30)
username.Position = UDim2.new(0, 60, 0.5, -15)
username.TextXAlignment = Enum.TextXAlignment.Left
username.Parent = avatarFrame

local infoFrame = Instance.new("Frame")
infoFrame.Name = "InfoFrame"
infoFrame.Size = UDim2.new(1, 0, 0, 110)  
infoFrame.Position = UDim2.new(0, 0, 0, 70)
infoFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
infoFrame.BackgroundTransparency = 0
infoFrame.Parent = content

local infoCorner = Instance.new("UICorner")
infoCorner.CornerRadius = UDim.new(0, 12)
infoCorner.Parent = infoFrame

local infoStroke = Instance.new("UIStroke")
infoStroke.Color = colors.stroke
infoStroke.Thickness = 1
infoStroke.Parent = infoFrame

local infoContainer = Instance.new("Frame")
infoContainer.Name = "InfoContainer"
infoContainer.Size = UDim2.new(1, -20, 1, -20)
infoContainer.Position = UDim2.new(0, 10, 0, 10)
infoContainer.BackgroundTransparency = 1
infoContainer.Parent = infoFrame

local buttonsFrame = Instance.new("Frame")
buttonsFrame.Name = "Buttons"
buttonsFrame.Size = UDim2.new(1, 0, 0, 150)
buttonsFrame.Position = UDim2.new(0, 0, 0, 190)  
buttonsFrame.BackgroundTransparency = 1
buttonsFrame.Parent = content

local topBarStroke = Instance.new("UIStroke")
topBarStroke.Color = colors.stroke
topBarStroke.Thickness = 2
topBarStroke.Parent = topBar

local avatarStroke = Instance.new("UIStroke")
avatarStroke.Color = colors.stroke
avatarStroke.Thickness = 2
avatarStroke.Parent = avatar

local function createInfoLabel(yPosition, text)
    local label = Instance.new("TextLabel")
    label.Text = text
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextColor3 = Color3.fromRGB(180, 180, 200)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.BackgroundTransparency = 1
    label.Size = UDim2.new(1, 0, 0, 20)
    label.Position = UDim2.new(0, 0, 0, yPosition)
    label.Parent = infoContainer
    return label
end

createInfoLabel(0, "Auto Farm Script")
createInfoLabel(20, "Version: 1.0")
createInfoLabel(40, "Status: Working")
createInfoLabel(60, "Game: Murder Mystery 2")

local telegramLabel = createInfoLabel(80, "t.me/OnyxHub")
telegramLabel.TextColor3 = colors.accent
telegramLabel.Font = Enum.Font.GothamBold

telegramLabel.MouseEnter:Connect(function()
    game:GetService("TweenService"):Create(
        telegramLabel,
        TweenInfo.new(0.2),
        {TextColor3 = Color3.fromRGB(140, 100, 255)}
    ):Play()
end)

telegramLabel.MouseLeave:Connect(function()
    game:GetService("TweenService"):Create(
        telegramLabel,
        TweenInfo.new(0.2),
        {TextColor3 = colors.accent}
    ):Play()
end)

telegramLabel.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        setclipboard("t.me/OnyxHub")
        Notify({
            Description = "Copied!";
            Title = "Onyx Hub";
            Duration = 2;
        })
    end
end)

local function createButton(name, text)
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.Text = text
    btn.Font = Enum.Font.GothamSemibold
    btn.TextSize = 14
    btn.TextColor3 = colors.text
    btn.BackgroundColor3 = colors.button
    btn.AutoButtonColor = false
    btn.Size = UDim2.new(1, 0, 0, 35)
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 8)
    btnCorner.Parent = btn
    
    local hover = false
    
    btn.MouseEnter:Connect(function()
        hover = true
        game:GetService("TweenService"):Create(
            btn,
            TweenInfo.new(0.2),
            {BackgroundColor3 = colors.buttonHover}
        ):Play()
    end)
    
    btn.MouseLeave:Connect(function()
        hover = false
        wait(0.1)
        if not hover then
            game:GetService("TweenService"):Create(
                btn,
                TweenInfo.new(0.2),
                {BackgroundColor3 = colors.button}
            ):Play()
        end
    end)
    
    return btn
end

local startBtn = createButton("Start", "Start Farming")
startBtn.Position = UDim2.new(0, 0, 0, 0)
startBtn.Parent = buttonsFrame

local stopBtn = createButton("Stop", "Stop Farming")
stopBtn.Position = UDim2.new(0, 0, 0, 45)
stopBtn.Parent = buttonsFrame

menuFrame.Parent = topBar
topBar.Parent = gui

local menuToggled = false
local targetHeight = 360

toggleBtn.MouseButton1Click:Connect(function()
    menuToggled = not menuToggled
    local targetSize = menuToggled and UDim2.new(1, 0, 0, targetHeight) or UDim2.new(1, 0, 0, 0)
    
    local tweenInfo = TweenInfo.new(
        ANIM_DURATION,
        EASING_STYLE,
        EASING_DIRECTION
    )
    
    local tween = TweenService:Create(menuFrame, tweenInfo, {Size = targetSize})
    tween:Play()
end)

local dragging = false
local dragStartPos
local guiStartPos

local function updatePosition(input)
    if dragging then
        local delta = input.Position - dragStartPos
        topBar.Position = UDim2.new(
            guiStartPos.X.Scale,
            guiStartPos.X.Offset + delta.X,
            guiStartPos.Y.Scale,
            guiStartPos.Y.Offset + delta.Y
        )
    end
end

topBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStartPos = input.Position
        guiStartPos = topBar.Position
    end
end)

topBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        updatePosition(input)
    end
end)



local autofarmEnabled = false
local movementSpeed = 25
local coinCheckInterval = 0.1
local lobbyPosition = Vector3.new(-120, 139, 40)
local lobbyRadius = 200
local player = game.Players.LocalPlayer
local noCoinsDetected = false
local farmLoop 


local function isInLobby()
    local character = player.Character
    if not character then return false end
    local root = character:FindFirstChild("HumanoidRootPart")
    return root and (root.Position - lobbyPosition).Magnitude <= lobbyRadius
end


local function smoothMove(targetPos)
    if isInLobby() or not autofarmEnabled then 
        return 
    end
    
    local character = player.Character
    if not character then return end
    local root = character:FindFirstChild("HumanoidRootPart")
    if not root then return end
    
    local startPos = root.Position
    local distance = (targetPos - startPos).Magnitude
    local duration = distance / movementSpeed
    
    local startTime = tick()
    
    while tick() - startTime < duration and autofarmEnabled do
        if isInLobby() then break end
        local elapsed = tick() - startTime
        local ratio = math.min(elapsed / duration, 1)
        root.CFrame = CFrame.new(startPos:Lerp(targetPos, ratio))
        task.wait()
    end

    if not isInLobby() and autofarmEnabled then
        root.CFrame = CFrame.new(targetPos)
    end
end

local function startFarmLoop()
    if farmLoop and coroutine.status(farmLoop) ~= "dead" then
        return
    end
    
    autofarmEnabled = true 
    noCoinsDetected = false  
    
    farmLoop = task.spawn(function()
        while autofarmEnabled do
           
         
            
            
            if isInLobby() then
                task.wait(1)
                continue 
            end

            local rootPart = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
            if not rootPart then
                task.wait(coinCheckInterval)
                continue
            end
         
            local coinsExist = false
            for _, obj in ipairs(workspace:GetDescendants()) do
                if obj.Name == "Coin_Server" and obj:IsA("BasePart") and obj:FindFirstChild("CoinVisual") then
                    coinsExist = true
                    break
                end
            end

           
            if not coinsExist and not noCoinsDetected then
                noCoinsDetected = true
                
                
                
            end
            
        
            if not coinsExist then
               
                task.wait(1)
                continue
                
            end
            
          
            if noCoinsDetected and coinsExist then
                noCoinsDetected = false
                
            end
            
           
            local nearestCoin, shortestDistance = nil, math.huge
            for _, obj in ipairs(workspace:GetDescendants()) do
                if obj.Name == "Coin_Server" and obj:IsA("BasePart") and obj:FindFirstChild("CoinVisual") then
                    local distance = (rootPart.Position - obj.Position).Magnitude
                    if distance < shortestDistance then
                        shortestDistance = distance
                        nearestCoin = obj
                    end
                end
            end

            if nearestCoin then
                if isInLobby() then break end
                smoothMove(nearestCoin.Position)
                
                if nearestCoin.Parent then 
                    firetouchinterest(rootPart, nearestCoin, 0)
                    firetouchinterest(rootPart, nearestCoin, 1)
                    task.wait(0.2)
                    pcall(nearestCoin.Destroy, nearestCoin)
                end
            else
                task.wait(coinCheckInterval)
            end
            
            if isInLobby() then break end
            task.wait(coinCheckInterval)
        end
    end)
end





local function handleDeath()
    if deathConnection then
        deathConnection:Disconnect()
        deathConnection = nil
    end
    
    deathConnection = player.CharacterAdded:Connect(function(newChar)
        local wasEnabled = autofarmEnabled
        autofarmEnabled = false
        
        task.wait(10)
        
        autofarmEnabled = wasEnabled
        if autofarmEnabled then
            for _, part in ipairs(newChar:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
            startFarmLoop()
        end
    end)
end
startBtn.MouseButton1Click:Connect(function()
    if autofarmEnabled then return end
    
    autofarmEnabled = true
    

    if player.Character then
        for _, part in ipairs(player.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
    
    handleDeath()
    startFarmLoop()
    
    Notify({
        Description = "Auto Farm started!";
        Title = "Onyx Hub";
        Duration = 2;
    })
end)

stopBtn.MouseButton1Click:Connect(function()
    if not autofarmEnabled then return end
    
    autofarmEnabled = false
    
    if deathConnection then
        deathConnection:Disconnect()
        deathConnection = nil
    end
    
    if farmLoop then
        task.cancel(farmLoop)
        farmLoop = nil
    end
    
    
    if player.Character then
        for _, part in ipairs(player.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = true
            end
        end
    end
    
    Notify({
        Description = "Auto Farm stopped!";
        Title = "Onyx Hub";
        Duration = 2;
    })
end)

setclipboard("t.me/OnyxHub")
Notify({
    Description = "Menu loaded successfully";
    Title = "Onyx Hub";
    Duration = 5;
});
